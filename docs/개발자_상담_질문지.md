# WORSHEEP 서비스 개발자 상담 질문지

**상담 일자:** 2025년 1월 18일
**서비스명:** WORSHEEP (예배팀 악보 관리 플랫폼)
**현재 상태:** MVP 개발 완료, 베타 테스트 준비 중
**GitHub:** https://github.com/minseo5494-crypto/ministry-hub

---

## 1. 서비스 기술 상세 (상담 전 공유용)

### 1-1. 기술 스택 상세

| 분류 | 기술 | 버전/상세 |
|------|------|-----------|
| **프레임워크** | Next.js | 15.5.9 (App Router 사용) |
| **언어** | TypeScript | 5.x |
| **스타일링** | Tailwind CSS | 4.x |
| **데이터베이스** | Supabase (PostgreSQL) | ap-southeast-1 (Singapore) |
| **인증** | Supabase Auth | Email, Google OAuth, Phone |
| **스토리지** | Supabase Storage | 악보 이미지/PDF 저장 |
| **배포** | Vercel | Git push 시 자동 배포 |
| **에러 모니터링** | Sentry | 프론트엔드 에러 추적 |
| **분석** | Google Analytics 4 | 사용자 행동 분석 |
| **AI** | Anthropic Claude API | AI 자연어 검색 (Haiku 모델) |
| **PWA** | next-pwa | 오프라인 지원 |

### 1-2. 개발 환경 및 도구

```
개발 도구:
├── IDE: VS Code + Cursor
├── AI 코딩 어시스턴트: Claude Code (CLI)
│   └── MCP (Model Context Protocol)로 Supabase 직접 연결
│       - 테이블 조회/생성
│       - SQL 실행
│       - 마이그레이션 관리
│       - Edge Functions 배포
├── 버전 관리: Git + GitHub
├── 패키지 매니저: npm
└── 로컬 개발: npm run dev (localhost:3000)
```

### 1-3. 프로젝트 구조

```
src/
├── app/                      # Next.js App Router
│   ├── page.tsx              # 메인 페이지 (곡 검색, 콘티 생성)
│   ├── admin/                # 관리자 페이지들
│   │   ├── dashboard/        # 통계 대시보드
│   │   ├── content-management/  # 콘텐츠 승인 관리
│   │   ├── song-approvals/   # 곡 업로드 승인
│   │   └── feedbacks/        # 피드백 관리
│   ├── auth/                 # 인증 (로그인, 회원가입)
│   ├── my-team/[id]/         # 팀 관리 페이지
│   │   └── setlist/[setlistId]/  # 콘티 상세/편집
│   ├── streaming/            # 스트리밍 송출 페이지
│   ├── upload/               # 악보 업로드
│   └── api/                  # API Routes
│       └── ai-search/        # AI 검색 엔드포인트
├── components/               # React 컴포넌트
│   ├── SheetMusicEditor/     # 악보 뷰어/에디터 (Canvas 기반)
│   ├── SongFormModal.tsx     # 송폼(곡 순서) 설정
│   └── SongFormPositionModal.tsx  # 송폼 위치/스타일 설정
├── hooks/                    # 커스텀 훅
│   ├── useAISearch.ts        # AI 검색 훅
│   └── useDownload.tsx       # PPT/PDF 다운로드
├── lib/                      # 유틸리티
│   ├── supabase.ts           # Supabase 타입 및 헬퍼
│   └── auth.ts               # 인증 헬퍼
└── utils/
    └── supabase/
        ├── client.ts         # 클라이언트 사이드 Supabase
        └── server.ts         # 서버 사이드 Supabase
```

### 1-4. 데이터베이스 스키마 (주요 테이블)

```sql
-- 핵심 테이블 관계도
songs (곡 정보)
  ├── id (PK)
  ├── song_name, team_name, key, bpm, tempo
  ├── lyrics (가사)
  ├── themes (테마: JSON 또는 comma-separated)
  ├── season (절기: 성탄절, 부활절 등)
  ├── is_official (공식 악보 여부)
  └── primary_sheet_id → song_sheets.id

song_sheets (악보 파일)
  ├── id (PK)
  ├── song_id → songs.id
  ├── file_url (Supabase Storage URL)
  ├── file_type (image/pdf)
  └── uploaded_by → users.id

teams (팀)
  ├── id (PK)
  ├── name, type (church_internal/external)
  ├── invite_code (초대 코드)
  └── created_by → users.id

team_members (팀원)
  ├── team_id → teams.id
  ├── user_id → users.id
  ├── role (admin/leader/member)
  └── role_id → team_roles.id (커스텀 직책)

team_setlists (팀 콘티)
  ├── id (PK)
  ├── team_id → teams.id
  ├── title, service_date, service_type
  └── created_by → users.id

team_setlist_songs (콘티 내 곡)
  ├── setlist_id → team_setlists.id
  ├── song_id → songs.id
  ├── order_number
  ├── key_transposed (조옮김)
  └── selected_form (선택된 송폼: ARRAY)

sheet_music_notes (개인 필기)
  ├── user_id → users.id
  ├── song_id → songs.id
  ├── annotations (JSON: 펜/형광펜/텍스트)
  ├── song_forms (JSON: 송폼 위치)
  └── part_tags (JSON: 파트 태그)

users (사용자)
  ├── id (PK, Supabase Auth UUID)
  ├── email, name, church_name
  ├── is_admin (관리자 여부)
  └── phone_verified, email_verified
```

### 1-5. 주요 기능 기술 설명

#### (1) 악보 뷰어/에디터 (Canvas 기반)
```
- HTML Canvas API 사용
- 기능: 펜, 형광펜, 텍스트, 지우개
- 송폼(곡 순서) 오버레이 표시
- 파트 태그(Intro, Verse, Chorus 등) 표시
- 줌 인/아웃, 페이지 네비게이션
- 필기 데이터: JSON으로 Supabase에 저장
- Soft Delete 방식 동기화 (deleted_at 컬럼)
```

#### (2) AI 자연어 검색
```
- Anthropic Claude API (Haiku 모델) 사용
- 사용자 자연어 → 구조화된 필터로 변환
  예: "선교 관련 느린 찬양"
  → { themes: ["선교"], tempo: "slow", lyricsKeywords: ["복음", "열방", "민족"...] }
- OR 조건 검색: 키워드 중 하나라도 매칭되면 표시
- 가사, 곡명, 아티스트 모두 검색
```

#### (3) 팀 콘티(세트리스트) 관리
```
- 드래그앤드롭으로 곡 순서 변경 (@dnd-kit 사용)
- 곡별 조옮김(Transpose) 설정
- 곡별 송폼 선택 (예: I-V1-C-V2-C-B-C)
- PPT/PDF 다운로드 (클라이언트 사이드 생성)
```

#### (4) 스트리밍 페이지
```
- 예배 중 악보 송출용 전체화면 페이지
- URL 공유로 다른 기기에서 접근
- 곡 전환, 송폼 표시
```

#### (5) 권한 시스템
```
- 사용자 레벨: 일반 사용자, 관리자(is_admin)
- 팀 레벨: admin, leader, member
- 커스텀 직책: team_roles + role_permissions 테이블
- RLS(Row Level Security): 모든 테이블에 적용
```

### 1-6. 인프라 구성

```
[사용자]
    ↓ HTTPS
[Vercel Edge Network]
    ↓
[Next.js App]
    ├── SSR/SSG 페이지
    ├── API Routes (/api/*)
    └── Static Assets
    ↓
[Supabase]
    ├── PostgreSQL (데이터)
    ├── Auth (인증)
    ├── Storage (파일)
    ├── Edge Functions (서버리스)
    └── Realtime (미사용 중)

[외부 서비스]
    ├── Anthropic API (AI 검색)
    ├── Sentry (에러 모니터링)
    ├── Google Analytics (분석)
    └── Cloudflare Turnstile (CAPTCHA)
```

### 1-7. 현재 알려진 이슈/기술 부채

| 이슈 | 상태 | 설명 |
|------|------|------|
| 테스트 코드 없음 | 미해결 | Unit/E2E 테스트 미작성 |
| page.tsx 파일 비대 | 미해결 | 메인 페이지 3800줄+ → 컴포넌트 분리 필요 |
| 이미지 최적화 | 부분 해결 | next/image 사용 중이나 추가 최적화 필요 |
| 모바일 최적화 | 진행 중 | iOS Safari 호환성 이슈 일부 해결 |
| Rate Limiting | 미구현 | API 호출 제한 없음 |
| 캐싱 전략 | 기본만 | Vercel 기본 캐싱만 사용 |

---

## 2. 개발 협업 및 프로세스 관련 질문

### 2-1. 팀 구성과 역할 분담
- [ ] 일반적으로 이 규모의 서비스를 개발할 때 어떤 역할의 개발자들이 필요한가요? 백엔드, 프런트, 디자이너
- [ ] 혼자 개발하다가 팀을 꾸릴 때 가장 먼저 필요한 역할은 무엇인가요? 백앤드
- [ ] 외주 개발자와 협업할 때 주의할 점은?

### 2-2. 협업 도구와 방식
- [ ] Git 브랜치 전략은 어떻게 가져가는 게 좋은가요? (현재는 main 브랜치만 사용 중)
- [ ] 코드 리뷰 프로세스는 어떻게 진행하나요?
- [ ] 이슈 관리와 버전 관리는 어떻게 하나요?

### 2-3. 개발 프로세스
- [ ] 기능 기획 → 개발 → 테스트 → 배포까지의 일반적인 플로우는?
- [ ] 기술 문서화는 어느 수준까지 해야 하나요?

---

## 3. 서비스 런칭 프로세스 질문

### 3-1. 런칭 전 체크리스트
- [ ] 서비스 런칭 전 필수로 점검해야 할 항목들은? 
  - 인증/인가 -> 로그인 (O)
  - 보안 -> SUPABASE 큰 문제 X, 구글 로그인
  - DB 관리 (Table 관리)
  - 디자인 -> Figma
  - 반응형 (핸드폰, 아이패드-가로,세로, 데스크탑, https://responsively.app/)
- [ ] 법적으로 준비해야 할 것들은? (개인정보처리방침, 이용약관 - 기본 버전 있음)
- [ ] 사업자 등록이 필요한 시점은 언제인가요?

### 3-2. 테스트 및 QA
- [ ] 베타 테스트는 어떤 방식으로 진행하는 게 효과적인가요?
- [ ] 자동화 테스트(Unit, E2E)는 어느 시점에 도입하는 게 좋은가요?
- [ ] 현재 테스트 코드가 없는데, 어디서부터 시작해야 할까요?

### 3-3. 배포 및 운영
- [ ] Vercel + Supabase 조합의 장단점은?
- [ ] 트래픽이 늘어났을 때 스케일링은 어떻게 하나요?
- [ ] 다운타임 없이 배포하는 방법은? -> CI/CD

---

## 4. 보안 관련 질문 (중요)

### 4-1. 최근 겪은 보안 이슈

> **상황 설명:**
> 며칠 전 Supabase 데이터베이스에 공격을 받았습니다.
> - 공격자가 테이블을 삭제하려는 시도 발생
> - 일부 테이블에 RLS(Row Level Security) 미적용 상태였음 -> RLS Disabled 적용
> - 공격 발견 후 모든 테이블에 RLS 적용 완료
> - Supabase 백업으로 데이터 복구 

**기술적 질문:**
- [ ] anon key가 노출되면 어떤 공격이 가능한가요?
- [ ] RLS 외에 추가로 적용해야 할 보안 정책은?
- [ ] 공격 로그를 확인하고 분석하는 방법은?
- [ ] 이런 공격을 방지하기 위한 체크리스트는?

### 4-2. 현재 보안 설정 상태

```
[적용됨]
✅ 모든 테이블 RLS 활성화
✅ Supabase Auth 사용 (JWT 기반)
✅ 환경변수로 API 키 관리 (.env.local)
✅ HTTPS 강제 (Vercel)
✅ Cloudflare Turnstile (회원가입 CAPTCHA)

[미적용/확인 필요]
❓ API Rate Limiting
❓ SQL Injection 방어 (Supabase 기본 제공?)
❓ XSS 방어 (React 기본 제공?)
❓ CORS 설정 검토
❓ 세션 타임아웃 설정
```

### 4-3. 추가 보안 질문
- [ ] Supabase anon key vs service_role key 사용 가이드라인은?
- [ ] 클라이언트에서 직접 Supabase 호출 vs API Route 경유, 어느 것이 더 안전한가요?
- [ ] 데이터베이스 백업 전략은? (현재 Supabase 자동 백업만 의존)
- [ ] 외부 보안 감사(Penetration Test)는 언제 받아야 하나요?

---

## 5. 아키텍처 및 코드 리뷰 요청

### 5-1. 현재 아키텍처에 대한 의견
- [ ] Next.js App Router + Supabase 조합에 대한 전반적인 평가?
- [ ] 클라이언트 직접 DB 접근 패턴의 장단점?
- [ ] 서버 컴포넌트 vs 클라이언트 컴포넌트 분리 기준은?

### 5-2. 코드 구조 개선
- [ ] page.tsx가 3800줄인데, 어떻게 분리하는 게 좋을까요?
  - app/main 디렉터리를 생성하고 현재 가장 상위 디렉터리에 있는 page.tsx에 있는 코드를 컴포넌트별로 분리하여 app/main 하위 디렉터리에 컴포넌트별로 분류해서 디렉터리르 생성해줘. 그 후에 만들었던 컴포넌트들을 main/page.tsx에 import해서 기존 src/page.tsx와 같은 구조로 만들어줘.

  
- [ ] 컴포넌트 폴더 구조 권장 사항은?
- [ ] 상태 관리 라이브러리(Zustand, Jotai 등) 도입이 필요한가요?

### 5-3. 성능 최적화
- [ ] React 렌더링 최적화 (useMemo, useCallback 사용 기준)
  - 코드 내에 불필요하게 re-rendering이 되고 있는 컴포넌트 혹은 함수가 있다면 useMemo와 useCallback으로 리팩터링 해줘.
- [ ] 이미지 로딩 최적화 방법
- [ ] 번들 사이즈 줄이는 방법

---

## 6. 향후 확장 질문

### 6-1. 모바일 앱
- [ ] React Native vs Flutter, 어떤 걸 추천하시나요?
  - Flutter 껍데기
  - webview -> component
- [ ] PWA로 충분한가요, 네이티브 앱이 필요한가요?

### 6-2. 실시간 기능
- [ ] Supabase Realtime 사용 경험이 있으신가요?
- [ ] 여러 사용자가 동시에 콘티 편집하는 기능 구현 시 고려할 점?

### 6-3. AI 기능 확장
- [ ] 현재 Claude Haiku 사용 중인데, 비용 관리 방법은?
- [ ] 자체 ML 모델 학습이 필요한 시점은?

---

## 7. 기타 질문

- [ ] 1인 개발자로서 우선순위 정하는 방법?
- [ ] 이 서비스의 가장 큰 기술적 리스크는 무엇으로 보시나요? 승호형
- [ ] 추가로 공부해야 할 기술/분야 추천

---

## 메모 공간

### 상담 중 메모


### 추가로 물어볼 것


### 액션 아이템 (상담 후 할 일)
- [ ]
- [ ]
- [ ]

---

*이 문서는 2025년 1월 17일 작성되었습니다.*
