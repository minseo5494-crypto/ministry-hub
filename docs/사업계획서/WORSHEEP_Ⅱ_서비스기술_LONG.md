
# Ⅱ. 서비스 및 기술 상세

WORSHEEP는 교회 찬양팀의 예배 준비 전 과정을 하나의 디지털 워크플로로 통합하는 플랫폼이다.

기존 찬양팀의 예배 준비 과정은 악보 탐색, 콘티 작성, 파트별 공유,
연습, 예배 실행까지 여러 도구와 플랫폼을 오가며 분절적으로 이루어지고 있다.

WORSHEEP는 이러한 문제를 '악보 중심의 예배 준비 흐름'으로 재정의한다.

---

## 1. 핵심 기능

### 1.1 통합 악보 라이브러리

공식 워십팀 악보와 사용자 생성 악보(UGC)를 한 곳에서 검색·관리할 수 있다.

**검색 및 필터링:**
- 곡명, 아티스트, 가사 키워드 검색
- 시즌별 필터 (성탄절, 부활절, 추수감사절 등)
- 테마별 필터 (찬양, 경배, 기도, 치유 등)
- 키(Key), 박자, 템포, BPM 범위 필터

**악보 정보 관리:**
- 곡 메타데이터 (제목, 아티스트, 키, BPM, 박자)
- 가사 및 유튜브 연동
- 다중 버전 악보 지원 (원키, 이조 버전)
- 좋아요/즐겨찾기 기능

### 1.2 AI 자연어 검색

Claude AI 기반의 자연어 검색 기능을 제공한다.

**작동 방식:**
```
입력: "부활절에 부르기 좋은 빠른 찬양"
→ AI가 자동으로 분석하여 필터 생성
→ season: "부활절", tempo: "빠름", themes: ["부활", "승리"]
→ 가사 관련 키워드 10-15개 자동 생성
```

**활용 예시:**
- "위로가 되는 찬양" → 테마: 평안, 가사 키워드: 위로, 눈물, 치유, 아픔...
- "시편 23편 관련 곡" → 가사 키워드: 목자, 푸른 초장, 사망의 음침한 골짜기...
- "빠른 템포의 찬양곡" → tempo: 빠름, BPM 필터 자동 적용

### 1.3 콘티(예배 순서) 제작

드래그 앤 드롭 방식으로 예배 순서를 구성할 수 있다.

**기능:**
- 악보 검색 → 드래그로 콘티에 추가
- 순서 변경 (드래그 앤 드롭)
- 예배 유형/날짜 설정
- 고정곡 기능 (여는찬양, 마치는찬양 등)
- 과거 콘티 복사 및 재사용
- 콘티 히스토리 관리

**팀 협업:**
- 팀원과 콘티 실시간 공유
- 권한별 편집/조회 제어
- 콘티별 메모 기능

### 1.4 악보 필기 및 편집

악보 위에 직접 필기하고, 송폼과 파트를 시각적으로 표시할 수 있다.

**그리기 도구:**
- 펜 (다양한 색상, 굵기)
- 형광펜 (반투명 강조)
- 지우개 (획 단위 삭제)
- 텍스트 추가

**고급 편집 기능:**
- 올가미 선택 (여러 객체 동시 선택/이동/삭제)
- Undo/Redo (편집 이력 관리)
- 터치/Apple Pencil 지원

**송폼 오버레이:**
- 악보 위에 예배 순서 표시 (V-C-B-Out 등)
- 크기 선택 (small/medium/large)
- WYSIWYG 위치 조정

**파트 태그:**
- 성부별 표시 (I: 빨강, V: 파랑, C: 초록, B: 보라 등)
- 드래그로 위치 조정
- 악보 구간별 파트 지정

### 1.5 피아노/드럼 악보 편집

전문 연주자를 위한 악보 편집 기능을 제공한다.

**피아노 악보:**
- 음표 입력 (C4-B8)
- 음표 길이 (4분음표, 8분음표, 16분음표 등)
- 코드 표기
- 마디 조정 (1-4마디)

**드럼 악보:**
- 8가지 드럼 파트 (HH, SN, KK, TH, TM, TL, CY, RD)
- 음표 타입 (normal, x, ghost)
- 음표 길이 조정

### 1.6 다중 기기 동기화

필기 데이터가 모든 기기에서 동기화된다.

**동기화 전략:**
- 로컬 스토리지 + Supabase 클라우드 하이브리드
- 타임스탬프 기반 최신 버전 우선
- Soft Delete 방식 (deleted_at 필드)
- 오프라인 환경에서도 작업 가능, 온라인 시 자동 동기화

### 1.7 다운로드 및 내보내기

다양한 형식으로 악보를 내보낼 수 있다.

**지원 형식:**
- PDF (악보 + 송폼 + 파트 태그 포함)
- 이미지 (PNG, JPG)
- PPT (예배용 프레젠테이션)

**PDF 생성 기능:**
- 표지 자동 생성 (제목, 날짜, 곡 목록)
- 한글 폰트 지원
- 송폼 오버레이 자동 삽입
- 파트 태그 자동 삽입
- 여백 조정 (0-30%)
- 진행률 표시

**배치 다운로드:**
- 콘티의 모든 곡 일괄 다운로드
- 선택한 곡만 다운로드

---

## 2. 팀 협업 기능

### 2.1 팀 관리

팀 단위의 악보 공유와 협업이 가능하다.

**팀 생성 및 초대:**
- 초대 코드 발급 (6자리 코드)
- 코드 입력으로 간편 가입
- 가입 승인 시스템 (리더 승인 필요)

**역할 관리:**
| 역할 | 권한 |
|------|------|
| Leader | 모든 권한 (팀 삭제, 멤버 관리, 콘티 편집) |
| Admin | 콘티 편집, 멤버 초대 |
| Member | 콘티 조회, 개인 필기 |

### 2.2 팀 악보 라이브러리

팀 전용 악보 라이브러리를 운영할 수 있다.

**기능:**
- 팀 고정곡 설정 (Opening, Closing 등)
- 팀별 자주 쓰는 곡 관리
- 팀원 간 악보 공유

---

## 3. 관리자 시스템

### 3.1 통계 대시보드

서비스 운영 현황을 실시간으로 파악할 수 있다.

**제공 지표:**
- DAU, WAU, MAU (활성 사용자)
- 인기곡 순위
- 다운로드 추이 (라인차트)
- 장치별 분석 (모바일/태블릿/데스크톱)
- 교회별 사용자 수
- 저작권 통계 (팀별 사용 현황)

### 3.2 콘텐츠 관리

악보 콘텐츠의 품질을 관리한다.

**기능:**
- 곡 승인 (공식 곡 등록)
- 사용자 업로드 곡 검토
- 저작권 위반 신고 처리
- 피드백 관리

### 3.3 사용자 관리

사용자 계정과 권한을 관리한다.

**기능:**
- 관리자 권한 부여
- 공식 업로더 지정
- 발행자(Publisher) 관리
- 계정 정지/복구

---

## 4. 정산 지수 (Settlement Index) 시스템

모든 사용 데이터는 **정산 지수(Settlement Index)**로 수치화되며,
이는 사역 수익 풀 배분의 핵심 기준으로 활용된다.

**측정 항목:**
| 행동 | 설명 |
|------|------|
| 악보 열람 | 악보 상세 페이지 조회 |
| 악보 다운로드 | PDF/이미지 다운로드 |
| 악보 필기 및 주석 | 필기 도구 사용, 메모 추가 |
| 콘티 포함 | 해당 악보가 콘티에 등록됨 |
| 예배 실행 | 예배일 기준 콘티 실행 (스트리밍) |

정산 지수는 단순 조회 수가 아니라 **실제 예배 준비 및 사용과 밀접한 행위**를 반영한다.

**좋아요(선호도) 지표:**
- 악보에 대한 이용자의 선호를 나타내는 보조 지표
- 정산 지수 산정 시 참고 또는 보정 요소로만 활용
- 단독으로 정산 금액을 결정하지 않음 (어뷰징 방지)

---

## 5. 기술 스택

### 5.1 프론트엔드

| 기술 | 용도 |
|------|------|
| Next.js 15 | React 프레임워크 (App Router) |
| TypeScript | 타입 안전성 |
| Tailwind CSS | UI 스타일링 |
| @dnd-kit | 드래그 앤 드롭 |
| perfect-freehand | 부드러운 펜 획 |
| pdf-lib | PDF 생성/편집 |
| jsPDF | PDF 출력 |
| Recharts | 차트/그래프 |

### 5.2 백엔드 및 인프라

| 기술 | 용도 |
|------|------|
| Supabase | 인증, 데이터베이스, 스토리지 |
| PostgreSQL | 관계형 데이터베이스 |
| Vercel | 배포 및 호스팅 |
| Cloudflare Turnstile | CAPTCHA 보안 |

### 5.3 AI 및 분석

| 기술 | 용도 |
|------|------|
| Anthropic Claude API | AI 자연어 검색 |
| Google Analytics 4 | 사용자 행동 분석 |
| Sentry | 에러 모니터링 |

### 5.4 보안

- RLS (Row Level Security): Supabase 정책 기반 접근 제어
- 업로드 제한: 시간당 20곡, 일일 100곡
- 스팸 방지: 한글 음절 패턴 분석
- CAPTCHA: 회원가입 시 Turnstile 적용

---

## 6. 모바일 최적화

iOS Safari를 포함한 모바일 환경에 최적화되어 있다.

**적용 사항:**
- input/textarea font-size 16px 이상 (자동 줌 방지)
- 버튼 최소 터치 영역 44px
- touch-action: manipulation 적용
- 터치 제스처 (핀치 줌, 팬, 스와이프)
- 반응형 레이아웃

---

## 7. 선순환 구조

WORSHEEP는 단순한 악보 저장 서비스가 아니라,
**예배 준비 → 실행 → 데이터 축적 → 수익 분배**로 이어지는
선순환 구조를 기술적으로 구현한 플랫폼이다.

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  악보 검색   │ →  │  콘티 제작   │ →  │  예배 사용   │
└─────────────┘    └─────────────┘    └─────────────┘
       ↑                                     │
       │                                     ↓
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  악보 개선   │ ←  │  수익 분배   │ ←  │  정산 지수   │
└─────────────┘    └─────────────┘    └─────────────┘
```

이 구조를 통해 교회, 사역팀, 창작자 모두가 지속 가능한 가치를 얻는다.
